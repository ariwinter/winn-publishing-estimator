<div class="wp-winncalc" id="wp-winncalc-1">
  <div class="winncalc-card">
    <div class="winncalc-title">Winn Publications Project Estimator</div>
    <div class="winncalc-hint">Answer a few quick questions to get an estimate and payment plan preview.</div>

    <label class="winncalc-label" for="winncalc-genre">1) Select your genre</label>
    <select class="winncalc-input" id="winncalc-genre">
      <option value="">Select…</option>

      <optgroup label="Specialty Genres (published in)">
        <option value="childrens" data-tier="specialty">Children’s</option>
        <option value="fantasy" data-tier="specialty">Fantasy</option>
        <option value="poetry" data-tier="specialty">Poetry</option>
        <option value="cookbook" data-tier="specialty">Cookbook</option>
        <option value="journal" data-tier="specialty">Journal</option>
        <option value="workbook" data-tier="specialty">Workbook</option>
        <option value="memoir" data-tier="specialty">Memoir</option>
        <option value="mystery" data-tier="specialty">Mystery</option>
        <option value="religious" data-tier="specialty">Religious</option>
        <option value="romantic_suspense" data-tier="specialty">Romantic Suspense</option>
        <option value="self_help" data-tier="specialty">Self-Help</option>
        <option value="social_issue" data-tier="specialty">Social Issue</option>
        <option value="spiritual" data-tier="specialty">Spiritual</option>
        <option value="thriller" data-tier="specialty">Thriller</option>
        <option value="travel" data-tier="specialty">Travel</option>
        <option value="young_adult" data-tier="specialty">Young Adult</option>
        <option value="coloring" data-tier="specialty">Coloring Book</option>
      </optgroup>

      <optgroup label="Expansion Genres (goal list)">
        <option value="science_fiction" data-tier="expansion">Science Fiction</option>
        <option value="romance" data-tier="expansion">Romance</option>
        <option value="historical_fiction" data-tier="expansion">Historical Fiction</option>
        <option value="horror" data-tier="expansion">Horror</option>
        <option value="anthology" data-tier="expansion">Anthology</option>
        <option value="graphic_novel" data-tier="expansion">Graphic Novels</option>
        <option value="adventure" data-tier="expansion">Adventure</option>
        <option value="humor" data-tier="expansion">Humor</option>
        <option value="dystopian" data-tier="expansion">Dystopian</option>
        <option value="lgbtq" data-tier="expansion">LGBTQ+ Literature</option>
        <option value="health_wellness" data-tier="expansion">Health & Wellness</option>
        <option value="womens_fiction" data-tier="expansion">Women’s Fiction</option>
      </optgroup>

      <option value="other" data-tier="other">Other (type your genre)</option>
    </select>

    <div class="winncalc-hidden" id="winncalc-otherGenreWrap">
      <label class="winncalc-label" for="winncalc-otherGenre">Type your genre</label>
      <input class="winncalc-input" id="winncalc-otherGenre" type="text" placeholder="e.g., Paranormal Romance" />
    </div>
  </div>

  <div class="winncalc-card winncalc-hidden" id="winncalc-typeCard">
    <div class="winncalc-subtitle">2) Book Type</div>

    <label class="winncalc-label" for="winncalc-bookType">Select your book type</label>
    <select class="winncalc-input" id="winncalc-bookType">
      <option value="text">Text-only book (most fiction & nonfiction)</option>
      <option value="childrens">Children’s book (illustrated)</option>
      <option value="coloring">Coloring book</option>
      <option value="cookbook">Cookbook (layout heavy)</option>
      <option value="workbook">Workbook / Journal (layout heavy)</option>
      <option value="graphic">Graphic novel / anthology (complex layout)</option>
    </select>

    <div class="winncalc-hint">We auto-suggest a type based on your genre. You can adjust if needed.</div>
  </div>

  <div class="winncalc-card winncalc-hidden" id="winncalc-lengthCard">
    <div class="winncalc-subtitle">3) Length</div>

    <div class="winncalc-hidden" id="winncalc-wordCountWrap">
      <label class="winncalc-label" for="winncalc-wordCount">Approx. word count</label>
      <input class="winncalc-input" id="winncalc-wordCount" type="number" min="0" step="1000" placeholder="e.g., 60000" />
      <div class="winncalc-hint">Used to estimate layout and production scope.</div>
    </div>

    <div class="winncalc-hidden" id="winncalc-childrenPagesWrap">
      <label class="winncalc-label" for="winncalc-childrenPages">How many illustrated pages?</label>
      <input class="winncalc-input" id="winncalc-childrenPages" type="number" min="0" step="1" placeholder="e.g., 24" />

      <label class="winncalc-label" for="winncalc-hasIllustrations">Do you already have illustrations provided?</label>
      <select class="winncalc-input" id="winncalc-hasIllustrations">
        <option value="yes">Yes (illustrations provided)</option>
        <option value="no">No</option>
      </select>

      <div class="winncalc-hidden" id="winncalc-illustrationMethodWrap">
        <label class="winncalc-label" for="winncalc-illustrationMethod">Illustration method</label>
        <select class="winncalc-input" id="winncalc-illustrationMethod">
          <option value="">Select…</option>
          <option value="ai">AI illustrations ($30/page)</option>
          <option value="custom">Custom illustrator (quote after review)</option>
          <option value="unsure">Not sure yet</option>
        </select>

        <div class="winncalc-hidden winncalc-hint" id="winncalc-storyboardWrap">
          <label class="winncalc-label" for="winncalc-hasStoryboard">Do you already have a storyboard?</label>
          <select class="winncalc-input" id="winncalc-hasStoryboard">
            <option value="yes">Yes</option>
            <option value="no">No</option>
          </select>

          <div class="winncalc-hidden winncalc-hint" id="winncalc-storyboardDemoWrap">
            If you don’t have one yet, view a storyboard demo:
            <a class="winncalc-link" href="REPLACE_WITH_YOUR_STORYBOARD_DEMO_URL" target="_blank" rel="noopener">Storyboard demo</a>
          </div>
        </div>
      </div>
    </div>

    <div class="winncalc-hidden" id="winncalc-pageCountWrap">
      <label class="winncalc-label" for="winncalc-pageCount">Approx. page count</label>
      <input class="winncalc-input" id="winncalc-pageCount" type="number" min="0" step="1" placeholder="e.g., 48" />
      <div class="winncalc-hint" id="winncalc-pageHint">Used for workbook/cookbook/graphic layout complexity.</div>

      <div class="winncalc-hidden" id="winncalc-coloringIllustrationsWrap">
        <label class="winncalc-label" for="winncalc-coloringHasIllustrations">Do you already have your coloring illustrations?</label>
        <select class="winncalc-input" id="winncalc-coloringHasIllustrations">
          <option value="yes">Yes (I’m providing my own illustrations)</option>
          <option value="no">No (I need help creating them)</option>
        </select>

        <div class="winncalc-hint" id="winncalc-coloringAIHint">
          If you don’t have illustrations, we’ll build your coloring book from start to publish using AI together.
          You receive full creator credit; Winn Publications receives publishing credit.
        </div>
      </div>
    </div>
  </div>

  <div class="winncalc-card winncalc-hidden" id="winncalc-servicesCard">
    <div class="winncalc-subtitle">4) Services Needed</div>

    <div class="winncalc-grid">
      <label class="winncalc-check"><input type="checkbox" id="svc-ebook" /> eBook formatting</label>
      <label class="winncalc-check"><input type="checkbox" id="svc-print" /> Paperback formatting</label>
      <label class="winncalc-check"><input type="checkbox" id="svc-cover" /> Cover design</label>
      <label class="winncalc-check"><input type="checkbox" id="svc-isbn" /> ISBN registration</label>
      <label class="winncalc-check"><input type="checkbox" id="svc-upload" /> Upload + platform setup</label>
      <label class="winncalc-check"><input type="checkbox" id="svc-launch" /> Launch kit (basic)</label>
    </div>

    <div class="winncalc-hint">Tip: Select the deliverables you want included in your estimate.</div>
  </div>

  <div class="winncalc-card winncalc-hidden" id="winncalc-payCard">
    <div class="winncalc-subtitle">5) Timeline & Payments</div>

    <label class="winncalc-label" for="winncalc-timeline">Timeline</label>
     <select class="winncalc-input" id="winncalc-timeline">
     <option value="3" selected>3 months</option>
    <option value="4">4 months</option>
    <option value="5">5 months</option>
    <option value="6">6 months</option>
        <option value="7">7 months</option>
        <option value="8">8 months</option>
        <option value="9">9 months</option>
        <option value="10">10 months</option>
        <option value="11">11 months</option>
        <option value="12">12 months</option>
</select>

<div class="winncalc-hint">
  Publishing date is tentative and based on the timeline you select.
</div>

    <div class="winncalc-hint" id="winncalc-estimatedPublish"></div>

    <label class="winncalc-label" for="winncalc-payplan">Payment option</label>
    <select class="winncalc-input" id="winncalc-payplan">
      <option value="monthly">Monthly payments</option>
      <option value="full">Pay in full (20% off)</option>
    </select>

    <div class="winncalc-hint" id="winncalc-paypolicy"></div>
    <div class="winncalc-summary winncalc-hint" id="winncalc-paymentSummary"></div>
    <div class="winncalc-hint winncalc-disclaimer" id="winncalc-disclaimer"></div>
  </div>

  <div class="winncalc-card winncalc-hidden" id="winncalc-estimateCard">
    <div class="winncalc-subtitle">Estimate</div>
    <div class="winncalc-summary winncalc-hint" id="winncalc-summary">Complete the steps above to see your estimate.</div>

    <div class="winncalc-totalLabel">Estimated Investment</div>
    <div class="winncalc-total" id="winncalc-total">$0</div>

    <div class="winncalc-hint" id="winncalc-savings"></div>
  </div>

  <style>
    .wp-winncalc {  max-width: 900px; margin: 0 auto; padding: 32px 20px;}
    .wp-winncalc .winncalc-card {
      border: 1px solid #ddd; border-radius: 12px; padding: 16px; margin-bottom: 16px; background: #fff;
    }
    .wp-winncalc .winncalc-title { font-size: 22px; font-weight: 800; margin-bottom: 6px; }
    .wp-winncalc .winncalc-subtitle { font-size: 16px; font-weight: 800; margin-bottom: 10px; }
    .wp-winncalc .winncalc-label { display: block; margin: 12px 0 6px; font-weight: 700; }
    .wp-winncalc .winncalc-input { width: 100%; padding: 16px 14px !important; border-radius: 14px; border: 1px solid #cfcfcf; font-size: 18px !important; line-height: 1.3 !important;
     min-height: 54px; box-sizing: border-box; }
    .wp-winncalc .winncalc-hint { color: #666; font-size: 14px; margin-top: 6px; }
    .wp-winncalc .winncalc-totalLabel { font-size: 14px; font-weight: 800; margin-top: 12px; }
    .wp-winncalc .winncalc-total { font-size: 26px; font-weight: 900; margin-top: 6px; }
    .wp-winncalc .winncalc-hidden { display: none; }
    .wp-winncalc .winncalc-link { text-decoration: none; }
    .wp-winncalc .winncalc-link:hover { text-decoration: underline; }
    .wp-winncalc .winncalc-summary { margin-top: 6px; }

    /* ✅ Deliverables row chips */
    .wp-winncalc .winncalc-grid{
      display: flex;
      flex-wrap: wrap;
      gap: 10px 16px;
      margin-top: 8px;
    }
    .wp-winncalc .winncalc-check{
      display: inline-flex;
      gap: 10px;
      align-items: center;
      font-weight: 700;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 999px;
      background: #fff;
      cursor: pointer;
      user-select: none;
    }
    .wp-winncalc .winncalc-check input{ transform: scale(1.15); }

    .wp-winncalc .winncalc-warning { font-weight: 800; }
    .wp-winncalc .winncalc-disclaimer { margin-top: 10px; }

  </style>

  <script>
    (function () {
      const root = document.getElementById('wp-winncalc-1');
      if (!root) return;

      // ---------- PRICING SETTINGS ----------
      const PRICING = {
        base: {
          text: 1800,
          childrens: 2400,
          coloring: 800,     // ✅ Coloring book base price
          cookbook: 2600,
          workbook: 2200,
          graphic: 3200
        },

        // ✅ Coloring per-page cost
        coloringPerPage: 7.50,

        wordAdders: [
          { max: 30000, add: 0 },
          { max: 60000, add: 300 },
          { max: 90000, add: 600 },
          { max: 120000, add: 900 },
          { max: Infinity, add: 1200 }
        ],

        pageAdders: [
          { max: 100, add: 0 },
          { max: 200, add: 250 },
          { max: 300, add: 500 },
          { max: Infinity, add: 750 }
        ],

        genrePremium: {
          specialty: 150,
          expansion: 75,
          other: 0
        },

        aiIllustrationPerPage: 30,

        fullPayDiscountRate: 0.20,
        priorityRushRate: 0.25
      };

      // ---------- ELEMENTS ----------
      const genre = root.querySelector('#winncalc-genre');
      const otherGenreWrap = root.querySelector('#winncalc-otherGenreWrap');
      const otherGenre = root.querySelector('#winncalc-otherGenre');

      const typeCard = root.querySelector('#winncalc-typeCard');
      const bookType = root.querySelector('#winncalc-bookType');

      const lengthCard = root.querySelector('#winncalc-lengthCard');
      const wordCountWrap = root.querySelector('#winncalc-wordCountWrap');
      const wordCount = root.querySelector('#winncalc-wordCount');

      const pageCountWrap = root.querySelector('#winncalc-pageCountWrap');
      const pageCount = root.querySelector('#winncalc-pageCount');
      const pageHint = root.querySelector('#winncalc-pageHint');

      const coloringIllustrationsWrap = root.querySelector('#winncalc-coloringIllustrationsWrap');
      const coloringHasIllustrations = root.querySelector('#winncalc-coloringHasIllustrations');
      const coloringAIHint = root.querySelector('#winncalc-coloringAIHint');

      const childrenPagesWrap = root.querySelector('#winncalc-childrenPagesWrap');
      const childrenPages = root.querySelector('#winncalc-childrenPages');
      const hasIllustrations = root.querySelector('#winncalc-hasIllustrations');
      const illustrationMethodWrap = root.querySelector('#winncalc-illustrationMethodWrap');
      const illustrationMethod = root.querySelector('#winncalc-illustrationMethod');
      const storyboardWrap = root.querySelector('#winncalc-storyboardWrap');
      const hasStoryboard = root.querySelector('#winncalc-hasStoryboard');
      const storyboardDemoWrap = root.querySelector('#winncalc-storyboardDemoWrap');

      const servicesCard = root.querySelector('#winncalc-servicesCard');
      const svc = {
        ebook: root.querySelector('#svc-ebook'),
        print: root.querySelector('#svc-print'),
        cover: root.querySelector('#svc-cover'),
        isbn: root.querySelector('#svc-isbn'),
        upload: root.querySelector('#svc-upload'),
        launch: root.querySelector('#svc-launch')
      };

      const payCard = root.querySelector('#winncalc-payCard');
      const timeline = root.querySelector('#winncalc-timeline');
      const payplan = root.querySelector('#winncalc-payplan');
      const paypolicy = root.querySelector('#winncalc-paypolicy');
      const estimatedPublishEl = root.querySelector('#winncalc-estimatedPublish');
      const paymentSummary = root.querySelector('#winncalc-paymentSummary');
      const disclaimer = root.querySelector('#winncalc-disclaimer');

      const estimateCard = root.querySelector('#winncalc-estimateCard');
      const summary = root.querySelector('#winncalc-summary');
      const totalEl = root.querySelector('#winncalc-total');
      const savingsEl = root.querySelector('#winncalc-savings');
      const printBtn = root.querySelector('#winncalc-printBtn');


      // ---------- HELPERS ----------
      function money(n) {
        const num = Number(n || 0);
        return num.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
      }

      function roundCents(n) {
        return Math.round((n + Number.EPSILON) * 100) / 100;
      }

      function addDays(d, days) {
        const x = new Date(d);
        x.setDate(x.getDate() + days);
        return x;
      }

      function toISODate(d) {
        const x = new Date(d);
        const yyyy = x.getFullYear();
        const mm = String(x.getMonth() + 1).padStart(2, '0');
        const dd = String(x.getDate()).padStart(2, '0');
        return `${yyyy}-${mm}-${dd}`;
      }

      function monthsBetweenInclusive(startDate, endDate) {
        const s = new Date(startDate.getFullYear(), startDate.getMonth(), 1);
        const e = new Date(endDate.getFullYear(), endDate.getMonth(), 1);
        let months = (e.getFullYear() - s.getFullYear()) * 12 + (e.getMonth() - s.getMonth()) + 1;
        return Math.max(1, months);
      }

      function buildMonthlySchedule(total, startDate, publishDate) {
        const nMonths = monthsBetweenInclusive(startDate, publishDate);
        const base = Math.floor((total / nMonths) * 100) / 100;
        let remainder = roundCents(total - base * nMonths);

        const payments = [];
        for (let i = 0; i < nMonths; i++) {
          const due = new Date(startDate);
          due.setMonth(due.getMonth() + i);

          let amt = base;
          if (remainder > 0) {
            amt = roundCents(amt + 0.01);
            remainder = roundCents(remainder - 0.01);
          }
          payments.push({ due, amt });
        }
        return payments;
      }

      function getGenreTier() {
        const opt = genre.options[genre.selectedIndex];
        return opt ? (opt.getAttribute('data-tier') || 'other') : 'other';
      }

      function suggestBookTypeFromGenre(genreVal) {
        if (!genreVal) return 'text';
        if (genreVal === 'childrens') return 'childrens';
        if (genreVal === 'coloring') return 'coloring';
        if (genreVal === 'cookbook') return 'cookbook';
        if (genreVal === 'journal' || genreVal === 'workbook') return 'workbook';
        if (genreVal === 'graphic_novel' || genreVal === 'anthology') return 'graphic';
        return 'text';
      }

      function wordAdderFor(count) {
        const wc = Number(count || 0);
        for (const tier of PRICING.wordAdders) {
          if (wc <= tier.max) return tier.add;
        }
        return 0;
      }

      function pageAdderFor(pages) {
        const pg = Number(pages || 0);
        for (const tier of PRICING.pageAdders) {
          if (pg <= tier.max) return tier.add;
        }
        return 0;
      }

      function servicesTotal() {
        let t = 0;
        if (svc.ebook.checked) t += 75;
        if (svc.print.checked) t += 450;
        if (svc.cover.checked) t += 350;
        if (svc.isbn.checked) t += 150;
        if (svc.upload.checked) t += 200;
        if (svc.launch.checked) t += 250;
        return t;
      }

      // ---------- PAYMENTS ----------
    
  function calcPayments(totalBeforePayments) {
  const monthsSelected = Number(timeline.value || 3);
  const today = new Date();

  // Pay in full = fixed 3-month timeline for publishing
  const payInFull = (payplan.value === 'full');
  const publishMonths = payInFull ? 3 : monthsSelected;

  // Estimated publish date (tentative)
  const estimatedPublish = new Date(today);
  estimatedPublish.setMonth(estimatedPublish.getMonth() + publishMonths);

  // Show estimated publish text
  const estimatedEl = root.querySelector('#winncalc-estimatedPublish');
  if (estimatedEl) {
    estimatedEl.innerHTML = `Estimated publish timeline: <strong>${publishMonths} month(s)</strong> (tentative).`;
  }

  // No rush fee / no calendar math anymore
  let finalTotal = roundCents(totalBeforePayments);
  let discount = 0;

  // Policy text
  if (payInFull) {
    paypolicy.innerHTML = `Pay in full: your project is placed on the <strong>3-month</strong> publishing timeline.`;
  } else {
    paypolicy.innerHTML = `Payment plan: timeline and payments are spread across <strong>${monthsSelected} month(s)</strong>.`;
  }

  // Pay in full discount
  if (payInFull) {
    discount = roundCents(finalTotal * PRICING.fullPayDiscountRate);
    finalTotal = roundCents(finalTotal - discount);

    savingsEl.textContent = discount > 0 ? `You saved ${money(discount)} with pay in full.` : '';

    paymentSummary.innerHTML =
      `• Publishing timeline: <strong>3 months</strong> (tentative)<br/>` +
      `• Pay in full discount (20%): -${money(discount)}<br/>` +
      `• Due today: <strong>${money(finalTotal)}</strong>`;
    
    disclaimer.textContent = 'Publishing timeline is tentative and begins after contract + onboarding. Final pricing is confirmed after manuscript review.';
    return { finalTotal, dueToday: finalTotal, discount };
  }

  // Payment plan: equal monthly payments over selected months
  savingsEl.textContent = '';

  const paymentCount = monthsSelected;
  const monthly = roundCents(finalTotal / paymentCount);

  // Fix rounding so totals always match
  const payments = [];
  let running = 0;
  for (let i = 1; i <= paymentCount; i++) {
    let amt = monthly;
    if (i === paymentCount) {
      amt = roundCents(finalTotal - running);
    }
    running = roundCents(running + amt);
    payments.push(amt);
  }

  paymentSummary.innerHTML =
    `• Publishing timeline: <strong>${monthsSelected} months</strong> (tentative)<br/>` +
    `• Number of payments: <strong>${paymentCount}</strong><br/>` +
    `• Due today: <strong>${money(payments[0])}</strong><br/>` +
    `• Remaining balance: ${money(roundCents(finalTotal - payments[0]))}<br/>` +
    `• Monthly payment estimate: ${money(monthly)} (final payment may differ by a few cents)`;

  disclaimer.textContent = 'Publishing timeline is tentative and begins after contract + onboarding. Final pricing is confirmed after manuscript review.';
  return { finalTotal, dueToday: payments[0], discount };
}


      // ---------- MAIN CALC ----------
      function calc() {
        const g = genre.value;

        const hasGenre = !!g;
        typeCard.classList.toggle('winncalc-hidden', !hasGenre);

        otherGenreWrap.classList.toggle('winncalc-hidden', g !== 'other');

        if (!hasGenre) {
          lengthCard.classList.add('winncalc-hidden');
          servicesCard.classList.add('winncalc-hidden');
          payCard.classList.add('winncalc-hidden');
          estimateCard.classList.add('winncalc-hidden');
          summary.textContent = 'Complete the steps above to see your estimate.';
          totalEl.textContent = money(0);
          savingsEl.textContent = '';
          paymentSummary.innerHTML = '';
          paypolicy.textContent = '';
          disclaimer.textContent = '';
          return;
        }

        const suggested = suggestBookTypeFromGenre(g);
        if (!bookType.dataset.userChanged) {
          bookType.value = suggested;
        }

        lengthCard.classList.remove('winncalc-hidden');
        servicesCard.classList.remove('winncalc-hidden');
        payCard.classList.remove('winncalc-hidden');
        estimateCard.classList.remove('winncalc-hidden');

        const bt = bookType.value;

        // Reset visibility
        wordCountWrap.classList.add('winncalc-hidden');
        pageCountWrap.classList.add('winncalc-hidden');
        childrenPagesWrap.classList.add('winncalc-hidden');
        coloringIllustrationsWrap.classList.add('winncalc-hidden');

        if (bt === 'text') {
          wordCountWrap.classList.remove('winncalc-hidden');
        } else if (bt === 'childrens') {
          childrenPagesWrap.classList.remove('winncalc-hidden');
        } else if (bt === 'coloring' || bt === 'cookbook' || bt === 'workbook' || bt === 'graphic') {
          pageCountWrap.classList.remove('winncalc-hidden');
        }

        // Coloring behavior
        if (bt === 'coloring') {
          coloringIllustrationsWrap.classList.remove('winncalc-hidden');
          pageHint.textContent = 'Used to estimate coloring book scope.';
        } else {
          pageHint.textContent = 'Used for workbook/cookbook/graphic layout complexity.';
        }

        // Children illustration logic ONLY for childrens
        if (bt === 'childrens') {
          const provided = hasIllustrations.value === 'yes';
          illustrationMethodWrap.classList.toggle('winncalc-hidden', provided);

          if (provided) {
            storyboardWrap.classList.add('winncalc-hidden');
            storyboardDemoWrap.classList.add('winncalc-hidden');
          } else {
            const method = illustrationMethod.value;
            const showAIPath = method === 'ai';
            storyboardWrap.classList.toggle('winncalc-hidden', !showAIPath);

            if (showAIPath) {
              const missing = hasStoryboard.value === 'no';
              storyboardDemoWrap.classList.toggle('winncalc-hidden', !missing);
            } else {
              storyboardDemoWrap.classList.add('winncalc-hidden');
            }
          }
        }

        // --- Build price ---
        let total = 0;
        let lines = [];

        // Base by type
        const base = PRICING.base[bt] ?? 0;
        total += base;
        lines.push(`Base (${bt.replace('_',' ')}): ${money(base)}`);

        // Length adders
        if (bt === 'text') {
          const wc = Number(wordCount.value || 0);
          const add = wordAdderFor(wc);
          total += add;
          lines.push(`Length (word count: ${wc.toLocaleString('en-US')}): ${money(add)}`);
        }

        // Coloring pricing: $800 base + $7.50/page
        if (bt === 'coloring') {
          const pg = Number(pageCount.value || 0);
          const perPage = roundCents(pg * PRICING.coloringPerPage);
          total += perPage;

          lines.push(`Coloring pages (page count: ${pg}): ${money(perPage)}`);

          if (coloringHasIllustrations.value === 'no') {
            lines.push(`AI-assisted creation: included (done with you).`);
          } else {
            lines.push(`Illustrations provided by author: included.`);
          }
        }

        // Other layout-heavy types use pageAdders
        if (bt === 'cookbook' || bt === 'workbook' || bt === 'graphic') {
          const pg = Number(pageCount.value || 0);
          const add = pageAdderFor(pg);
          total += add;
          lines.push(`Length (page count: ${pg}): ${money(add)}`);
        }

        // Children pricing details
        if (bt === 'childrens') {
          const pages = Number(childrenPages.value || 0);
          lines.push(`Illustrated pages: ${pages}`);

          if (hasIllustrations.value === 'no') {
            if (illustrationMethod.value === 'ai') {
              const aiCost = PRICING.aiIllustrationPerPage * pages;
              total += aiCost;
              lines.push(`AI illustrations ($${PRICING.aiIllustrationPerPage}/page): ${money(aiCost)}`);
            } else if (illustrationMethod.value === 'custom') {
              lines.push('Custom illustrator: quote after review (not included in estimate).');
            } else if (illustrationMethod.value === 'unsure') {
              lines.push('Illustrations not decided yet: we’ll confirm options on your consult.');
            } else {
              lines.push('Select an illustration method to refine estimate.');
            }
          } else {
            lines.push('Illustrations provided by author: included in base.');
          }
        }

        // Genre premium
        const tier = getGenreTier();
        const premium = PRICING.genrePremium[tier] ?? 0;
        total += premium;

        const genreLabel = (g === 'other' && otherGenre.value) ? otherGenre.value : genre.options[genre.selectedIndex].text;
        lines.push(`Genre (${genreLabel}) premium: ${money(premium)}`);

        // Services
        const svcTotal = servicesTotal();
        total += svcTotal;
        lines.push(`Selected services: ${money(svcTotal)}`);

        // Payment adjustments
        const paymentInfo = calcPayments(total);

        // Display
        summary.innerHTML = lines.map(l => `• ${l}`).join('<br/>');
        totalEl.textContent = money(paymentInfo.finalTotal);
      }

      // Mark type as user-changed if they manually change it
      bookType.addEventListener('change', function () {
        bookType.dataset.userChanged = 'true';
        calc();
      });

      // Events
      [
        genre, otherGenre,
        wordCount, pageCount,
        childrenPages, hasIllustrations, illustrationMethod, hasStoryboard,
        coloringHasIllustrations,
        svc.ebook, svc.print, svc.cover, svc.isbn, svc.upload, svc.launch,
        timeline, payplan
        ].forEach(el => el && el.addEventListener('change', calc))

      
      // Initialize
      calc();
    })();
    

  </script>
</div>


